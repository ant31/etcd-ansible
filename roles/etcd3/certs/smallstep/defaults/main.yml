---
# Smallstep version
step_version: "0.25.2"
step_ca_version: "0.25.2"

# Smallstep CA configuration
step_ca_name: "etcd-{{ etcd_cluster_name }}-ca"
step_ca_dns: "{{ hostvars[groups[etcd_certmanagers_group][0]]['ansible_fqdn'] }}"
step_ca_url: "https://{{ step_ca_dns }}:9000"
step_ca_port: 9000
step_ca_provisioner: "etcd-provisioner"

# Paths
step_path: "/etc/step-ca"
step_ca_config: "{{ step_path }}/config/ca.json"
step_ca_db: "{{ step_path }}/db"
step_ca_certs: "{{ step_path }}/certs"
step_ca_secrets: "{{ step_path }}/secrets"

# Certificate settings
step_cert_default_duration: "17520h"  # 2 years (730 days)
step_cert_max_duration: "26280h"      # 3 years
step_cert_min_duration: "1h"

# Renewal settings - renew when 2/3 of lifetime has passed
step_cert_renew_period: "11688h"  # ~487 days (2/3 of 2 years)

# Password for CA keys (should be stored in ansible-vault in production)
step_ca_password: "{{ lookup('password', '/dev/null chars=ascii_letters,digits length=32') }}"
step_provisioner_password: "{{ lookup('password', '/dev/null chars=ascii_letters,digits length=32') }}"

# Backup encryption configuration
step_ca_backup_encryption_method: "aws-kms"  # Options: aws-kms, symmetric, aws-s3-sse
step_ca_backup_kms_key_id: "alias/etcd-ca-backup"  # AWS KMS key alias or ARN
step_ca_backup_password: ""  # Password for symmetric encryption (store in ansible-vault)
step_ca_backup_s3_bucket: "etcd-backups"  # S3 bucket for CA backups
step_ca_backup_s3_prefix: "step-ca"  # S3 prefix/folder
step_ca_backup_s3_enabled: true  # Enable S3 uploads
step_ca_backup_retention_days: 90  # Delete backups older than this

# AWS KMS Key Policy - required IAM permissions for etcd nodes
# Nodes need kms:Encrypt, kms:Decrypt, kms:DescribeKey on the KMS key
# Example: arn:aws:iam::ACCOUNT_ID:role/etcd-nodes-role
step_ca_backup_kms_principal: ""  # IAM role ARN for etcd nodes (optional, set in vault.yml)
