---
- name: Confirm certificate deletion
  pause:
    prompt: "⚠️  WARNING: This will DELETE all certificates on {{ inventory_hostname }}. Certificates will need to be regenerated. Type 'yes' to confirm"
  register: confirm_cert_delete
  when: cleanup_require_confirm | default(true)

- name: Validate confirmation
  assert:
    that:
      - not (cleanup_require_confirm | default(true)) or confirm_cert_delete.user_input == 'yes'
    fail_msg: "Certificate deletion cancelled by user"
  when: cleanup_require_confirm | default(true)

- name: Remove certificate directories
  file:
    path: /etc/etcd/ssl
    state: absent

- name: Remove step-ca directory
  file:
    path: /etc/step-ca
    state: absent
  when: inventory_hostname in groups[etcd_certmanagers_group]
