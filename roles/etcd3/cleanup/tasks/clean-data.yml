---
- name: Confirm data deletion
  pause:
    prompt: "This will DELETE etcd data for cluster {{ etcd_cluster_name }} on {{ inventory_hostname }}. Type 'yes' to confirm"
  register: confirm_delete
  when: cleanup_require_confirm | default(true) | bool

- name: Validate confirmation
  assert:
    that:
      - not (cleanup_require_confirm | default(true) | bool) or confirm_delete.user_input == 'yes'
    fail_msg: "Data deletion cancelled"
  when: cleanup_require_confirm | default(true) | bool

- name: Stop etcd service (cluster-specific)
  systemd:
    name: "{{ etcd_clusters[etcd_cluster_name].etcd_name }}"
    state: stopped
  failed_when: false

- name: Remove etcd data directory (cluster-specific)
  file:
    path: "{{ etcd_clusters[etcd_cluster_name].etcd_data_dir }}"
    state: absent
