---
- name: Restore CA from node (direct copy)
  include_tasks: restore-ca-from-node-direct.yml
  when: restore_action | default('') == 'ca-from-node'
  tags:
    - restore
    - restore-ca

- name: Validate restore configuration
  assert:
    that:
      - restore_ca or restore_etcd_data
      - restore_ca_from in ['s3', 'local', 'backup-node'] or not restore_ca
    fail_msg: "Invalid restore configuration"
  when: restore_action | default('') != 'ca-from-node'
  tags:
    - restore
    - validate

- name: Restore CA
  include_tasks: restore-ca.yml
  when: restore_ca and restore_action | default('') != 'ca-from-node'
  tags:
    - restore
    - restore-ca

- name: Restore etcd data
  include_tasks: restore-etcd.yml
  when: restore_etcd_data
  tags:
    - restore
    - restore-etcd
