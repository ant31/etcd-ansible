---
# NOTE: Automated backups support multiple encryption methods
#
# Encryption methods:
#   - aws-kms: AWS KMS client-side encryption (requires AWS CLI, credentials, kms:Encrypt/Decrypt)
#   - symmetric: OpenSSL AES-256-CBC encryption (requires step_ca_backup_password in vault.yml)
#   - none: No encryption (not recommended for production)
#
# AWS CLI is automatically downloaded when encryption method is 'aws-kms'
# Credentials passed via environment variables from vault.yml

# Backup scheduling - ENABLED BY DEFAULT
etcd_backup_cron_enabled: true
etcd_backup_interval: "*/30"  # Every 30 minutes (format: */N for every N minutes, or cron format)
etcd_backup_cron_minute: "*/30"
etcd_backup_cron_hour: "*"

# Distributed backup strategy (high availability)
# Two modes:
#
# 1. DISTRIBUTED MODE (default): Coordinated backups with deduplication
#    - All nodes attempt backups, staggered across the interval
#    - Each node checks S3 before creating backup (prevents duplicates)
#    - Formula: offset = (node_index - 1) * (interval / cluster_size)
#    - Example: 5 nodes, 60min interval = offsets 0,12,24,36,48 minutes
#    - Result: One backup per interval (node 1 succeeds, others skip)
#
# 2. INDEPENDENT MODE: Uncoordinated backups for higher frequency
#    - All nodes create backups independently (no S3 check)
#    - Use larger base interval with frequent node attempts
#    - Example: 5-hour base, 1-hour node attempts = backup every hour
#    - Result: Multiple backups per interval (different node each hour)
#
etcd_backup_distributed: true  # Enable multi-node backups
etcd_backup_independent: false  # If true, skip deduplication (each node always creates backup)

# Online-only backup mode (abort if cluster unhealthy)
# Default: false (always backup, filename indicates online/offline status)
etcd_backup_online_only: false

# CA backup - only when changed - ENABLED BY DEFAULT
ca_backup_cron_enabled: true
ca_backup_check_interval: "*/5"  # Check every 5 minutes if CA changed
ca_backup_cron_minute: "*/5"
ca_backup_cron_hour: "*"

# Trigger initial backup after deployment
etcd_backup_initial_run: true
ca_backup_initial_run: true

# Deadman monitoring (optional)
backup_healthcheck_enabled: false
backup_healthcheck_url: ""  # e.g., https://hc-ping.com/your-uuid or https://deadmanssnitch.com/your-snitch
ca_backup_healthcheck_url: ""

# Backup retention
etcd_backup_retention_days: 90
ca_backup_retention_days: 365

# Paths (all root-owned)
etcd_backup_dir: "/opt/backups"  # Root directory for all backups
backup_scripts_dir: "/opt/etcd-backup-scripts"
backup_log_dir: "/var/log/etcd-backups"
