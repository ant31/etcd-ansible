# Etcd backup configuration
# Generated by Ansible - managed file (changes tracked with backup: yes)

# Node identification
node_name: "{{ inventory_hostname }}"

# Cluster configuration
cluster_name: "{{ etcd_cluster_name }}"
etcd_endpoints: "{{ etcd_clusters[etcd_cluster_name].etcd_access_addresses }}"

# Certificate paths
cert: "{{ etcd_clusters[etcd_cluster_name].etcd_cert_paths.client.cert }}"
key: "{{ etcd_clusters[etcd_cluster_name].etcd_cert_paths.client.key }}"
cacert: "{{ etcd_clusters[etcd_cluster_name].etcd_cert_paths.client.ca }}"

# Backup paths
backup_dir: "{{ etcd_cluster_backup_directory }}"
backup_tmp_dir: "{{ backup_tmp_dir | default('/opt/backups/tmp') }}"
bin_dir: "{{ bin_dir }}"

# Etcd data directory pattern for offline backups (when cluster is unhealthy)
etcd_data_dir_pattern: "{{ etcd_home }}/etcd-{{ etcd_cluster_name }}-*"

# S3 configuration
s3_bucket: "{{ etcd_backup_s3_bucket }}"
# S3 prefix includes cluster name automatically
# Per-cluster override: etcd_cluster_configs[cluster_name].backup_s3_prefix
# Example: "prod/k8s/" vs "prod/events/"
s3_prefix: "{{ etcd_backup_s3_prefix }}{{ etcd_cluster_name }}/"

# Encryption configuration
encryption_method: "{{ step_ca_backup_encryption_method }}"
kms_key_id: "{{ step_ca_backup_kms_key_id }}"
backup_password: "{{ step_ca_backup_password }}"

# AWS credentials
aws_access_key_id: "{{ aws_access_key_id | default('') }}"
aws_secret_access_key: "{{ aws_secret_access_key | default('') }}"
aws_region: "{{ aws_default_region | default('us-east-1') }}"

# Backup strategy
backup_interval_minutes: {{ (etcd_backup_interval | replace('*/', '') | replace('*/','') | int) }}
distributed_backup: {{ etcd_backup_distributed | default(true) | lower }}
local_retention_days: {{ etcd_backup_local_retention_days }}
cleanup_enabled: {{ etcd_backup_cleanup_enabled | default(true) | lower }}

# Monitoring
healthcheck_url: "{{ backup_healthcheck_url }}"
